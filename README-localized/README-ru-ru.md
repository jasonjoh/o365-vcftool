# Пример импорта и экспорта файлов VCF в Microsoft Graph Office 365

[![Состояние сборки](https://travis-ci.org/jasonjoh/o365-vcftool.svg?branch=master)](https://travis-ci.org/jasonjoh/o365-vcftool)

Этот пример Ruby on Rails показывает как использовать [API контактов](https://docs.microsoft.com/graph/outlook-contacts-concept-overview) для работы с личными контактами.

## Необходимое программное обеспечение

- [Ruby on Rails](http://rubyonrails.org/)
- [Yarn](https://classic.yarnpkg.com/en/)
- [omniauth-oauth2](https://github.com/omniauth/omniauth-oauth2)
- [httparty](https://github.com/jnunemaker/httparty)
- [vcard](https://rubygems.org/gems/vcard)

## Регистрация приложения

1. Откройте браузер и перейдите в [Центр администрирования Azure Active Directory](https://aad.portal.azure.com). Войдите с помощью **личной учетной записи** (т. е. учетной записи Майкрософт) или **рабочей или учебной учетной записи**.

1. Выберите **Azure Active Directory** на панели навигации слева, затем выберите **Регистрация приложений** в разделе **Управление**.

1. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом:

   - В качестве параметра **Имя** укажите `Средство VCF для контактов Outlook`.
   - В качестве значения параметра **Поддерживаемые типы учетных записей** задайте **Учетные записи в любом каталоге организации и персональные учетные записи Майкрософт**.
   - В разделе **URI перенаправления** выберите в первом раскрывающемся списке значение `Веб` и установите для него значение `http://localhost:3000/auth/microsoft_graph_auth/callback`.

1. Нажмите **Зарегистрировать**. На странице **Учебник Graph Ruby** скопируйте значение **Идентификатора приложения (клиента)** и сохраните его, оно потребуется на следующем шаге.

1. Выберите **Разрешения API** в разделе **Управление**.  Выберите **Добавить разрешение**. Выберите **Microsoft Graph** и **Делегированные разрешения**. Добавьте разрешение **Contacts.ReadWrite** и выберите**Добавить разрешения**.

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание**, выберите один из вариантов **срока действия** и нажмите **Добавить**.

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Оно понадобится вам на следующем шаге.

   > **Важно!** Этот секрет клиента больше не будет отображаться, поэтому обязательно скопируйте его.

## Настройка примера

В этом примере считывается идентификатор и секрет приложения из API учетных данных Rails. Эти значения требуется добавить в файл **credentials.yml.enc**.

1. Откройте интерфейс командной строки (CLI) в каталоге **./vcftool**.
1. Чтобы изменить учетные данные, выполните следующую команду:

    ```shell
	rails credentials:edit
     ```

    > **Примечание.** Если возникает ошибка `Отсутствует $EDITOR для открытия файла`, нужно настроить текстовый редактор в переменной среды `EDITOR`. Для получения дополнительных сведений, выполните команду `rails credentials:help` или посетите страницу [Защита приложений Rails](https://guides.rubyonrails.org/security.html#custom-credentials).

1. Добавьте следующее в файл учетных данных и сохраните его.

    ```yml
    # Azure
    azure:
	app_id: c9fb1bd9-ecc1-4c8a-a945-8f587dc95826
	app_secret: Y7UjylVrdEBiPuIiRz@Ai@.tO:OX205@
	```

## Запуск примера

## Настройка

1. Откройте CLI и выполните команду `bundle install`, чтобы установить зависимости.
1. Выполните `bundle exec rake db:setup` для настройки базы данных.
1. Чтобы запустить пример, выполните команду `rails server`.
1. Откройте браузере и перейдите по адресу [http://localhost:3000](http://localhost:3000).

## Авторские права

(c) Корпорация Майкрософт (Microsoft Corporation). Все права защищены.

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [вопросов и ответов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

---------
Свяжитесь со мной в Twitter [@JasonJohMSFT](https://twitter.com/JasonJohMSFT)
